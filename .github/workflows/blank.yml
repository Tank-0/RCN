name: Intigriti Program Status Checker

on:
  schedule:
    - cron: "*/15 * * * *"  # every 15 minutes
  workflow_dispatch:       # allow manual run

jobs:
  check-status:
    runs-on: ubuntu-latest

    steps:
      - name: Check if program is suspended
        run: |
          URL="https://app.intigriti.com/researcher/programs/flexmail/flexmailbugbountyprogram/detail"
          RESPONSE=$(curl -s "$URL")

          if echo "$RESPONSE" | grep -q "This program is currently suspended"; then
            echo "Program is suspended, no alert."
          else
            echo "Program is open, sending Telegram alert..."
            MESSAGE="ðŸš¨ Intigriti Flexmail program is OPEN! ðŸš€"
            curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
              -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
              -d text="$MESSAGE"
          fi
